<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyze | CareerSafe - AI-Powered Analysis Suite</title>
    <meta name="description"
        content="Analyze job offers, verify companies, and get AI career guidance with CareerSafe's powerful detection tools.">

    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gst    atic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

    <!-- Load Scripts -->
    <!-- Load Scripts -->
    <link rel="stylesheet" href="assets/main.css">
    <script src="./assets/config.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Google Maps API with callback -->
    <script>
        // Global callback for when Google Maps API loads
        function initGoogleMaps() {
            console.log('Google Maps API loaded successfully');
            window.googleMapsLoaded = true;
        }
    </script>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&libraries=places&callback=initGoogleMaps"
        async defer></script>
</head>

<body class="animate-gradient min-h-screen">
    <!-- Loading Screen -->
    <div id="pageLoader">
        <div>
            <div class="loader-spinner mx-auto"></div>
            <p class="text-white text-xl font-semibold mt-6">Initializing AI Tools...</p>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="glass-nav sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-10 py-4">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl sm:text-3xl font-bold gradient-text flex items-center gap-2">
                    <span class="text-4xl">üõ°Ô∏è</span>
                    <span>CareerSafe</span>
                </h1>
                <div
                    class="flex flex-wrap items-center gap-4 sm:gap-6 text-sm sm:text-base font-black uppercase tracking-widest">
                    <a href="index.html" class="text-white/60 hover:text-white transition">Home</a>
                    <a href="features.html" class="text-white/60 hover:text-white transition">Features</a>
                    <a href="analyze.html"
                        class="text-indigo-400 font-black hover:text-indigo-300 transition">Analyze</a>
                    <a href="resume.html" class="text-white/60 hover:text-white transition">Resume</a>
                    <a href="login.html"
                        class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-2 rounded-full font-semibold hover:from-blue-700 hover:to-purple-700 transition shadow-lg"
                        id="loginBtn">Get Started</a>
                    <a href="dashboard.html"
                        class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-2 rounded-full font-semibold hover:from-purple-700 hover:to-pink-700 transition shadow-lg hidden"
                        id="dashboardBtn">Dashboard</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Content -->
    <div class="container mx-auto px-4 sm:px-10 py-12">
        <div class="text-center mb-12 fade-up">
            <h1 class="text-4xl sm:text-6xl font-black mb-6 text-white drop-shadow-2xl">
                Powerful <span class="gradient-text">AI Analysis</span>
            </h1>
            <p class="text-xl text-white/90 max-w-3xl mx-auto leading-relaxed drop-shadow-lg">
                Use our suite of tools to detect scams, verify professional identities, and plan your career path with
                confidence.
            </p>
        </div>

        <!-- Tab Navigation -->
        <div class="flex flex-wrap justify-center gap-4 mb-12 fade-up">
            <button onclick="switchTab('job-risk')" id="tab-job-risk"
                class="tab-btn active glass-card px-8 py-4 rounded-2xl font-black text-lg flex items-center gap-3 text-white">
                <span>üîç</span> Job Risk
            </button>
            <button onclick="switchTab('company')" id="tab-company"
                class="tab-btn glass-card text-gray-400 px-8 py-4 rounded-2xl font-black text-lg flex items-center gap-3">
                <span>üè¢</span> Company Verify
            </button>
            <button onclick="switchTab('career')" id="tab-career"
                class="tab-btn glass-card text-gray-400 px-8 py-4 rounded-2xl font-black text-lg flex items-center gap-3">
                <span>ü§ñ</span> Career AI
            </button>
        </div>

        <!-- Tabs Content -->
        <div id="content-job-risk" class="tab-content">
            <section class="glass-card rounded-[2.5rem] p-8 sm:p-12 fade-up border-white/10">
                <h2 class="text-3xl font-black text-white mb-8 flex items-center gap-3">
                    <span class="text-4xl">üîç</span> Job Risk Intelligence
                </h2>
                <div class="mb-8">
                    <label class="block text-xs font-black text-gray-400 mb-3 uppercase tracking-widest">Input Job
                        Description or Offer Text</label>
                    <textarea id="inputText"
                        class="w-full border border-white/10 bg-slate-900/50 text-white p-6 rounded-2xl focus:outline-none focus:ring-4 focus:ring-indigo-500/20 focus:border-indigo-500 transition resize-y min-h-[200px] placeholder-gray-500 font-medium backdrop-blur-md"
                        placeholder="Paste the job description or offer message here for instant AI risk assessment..."></textarea>

                    <div class="mt-6">
                        <p class="text-xs font-black text-gray-400 mb-3 uppercase tracking-widest">‚ö° Quick Test
                            Scenarios</p>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="loadAndAnalyze(0)"
                                class="text-xs bg-white hover:bg-red-50 text-red-600 px-4 py-2 rounded-xl border border-red-100 transition font-bold shadow-sm">üî¥
                                Scam Attempt</button>
                            <button onclick="loadAndAnalyze(1)"
                                class="text-xs bg-white hover:bg-green-50 text-green-600 px-4 py-2 rounded-xl border border-green-100 transition font-bold shadow-sm">‚úÖ
                                Safe Listing</button>
                            <button onclick="loadAndAnalyze(2)"
                                class="text-xs bg-white hover:bg-yellow-50 text-yellow-600 px-4 py-2 rounded-xl border border-yellow-100 transition font-bold shadow-sm">‚ö†Ô∏è
                                Suspicious</button>
                        </div>
                    </div>
                </div>
                <button onclick="analyzeRisk()"
                    class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-5 rounded-2xl font-black text-xl hover:from-blue-700 hover:to-purple-700 transition transform hover:scale-[1.02] shadow-xl"
                    id="analyzeBtn">Analyze Risk Now</button>

                <div id="result" class="hidden mt-12 fade-up">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                        <div class="glass-card p-8 rounded-[2.5rem] flex items-center justify-center border-white/5">
                            <canvas id="riskChart" height="250"></canvas>
                        </div>
                        <div id="riskText" class="space-y-6"></div>
                    </div>
                </div>
            </section>
        </div>

        <div id="content-company" class="tab-content hidden">
            <section class="glass-card rounded-[2.5rem] p-8 sm:p-12 fade-up border-white/10">
                <h2 class="text-3xl font-black text-white mb-8 flex items-center gap-3">
                    <span class="text-4xl">üè¢</span> Company Authenticity
                </h2>
                <div class="mb-8">
                    <label class="block text-xs font-black text-gray-400 mb-3 uppercase tracking-widest">Global Company
                        Name</label>
                    <div class="relative">
                        <input id="companyName" type="text"
                            class="w-full border border-white/10 bg-slate-900/50 text-white p-6 rounded-2xl focus:outline-none focus:ring-4 focus:ring-emerald-500/20 focus:border-emerald-500 transition placeholder-gray-500 font-bold text-lg backdrop-blur-md"
                            placeholder="e.g., Google, Amazon, Meta...">
                        <div class="mt-4 flex flex-wrap gap-2">
                            <button onclick="document.getElementById('companyName').value='Amazon'; verifyCompany()"
                                class="text-[10px] bg-white/5 border border-white/10 text-gray-400 px-4 py-2 rounded-xl hover:bg-white/10 transition font-black uppercase tracking-widest">Amazon</button>
                            <button onclick="document.getElementById('companyName').value='Meta'; verifyCompany()"
                                class="text-[10px] bg-white/5 border border-white/10 text-gray-400 px-4 py-2 rounded-xl hover:bg-white/10 transition font-black uppercase tracking-widest">Meta</button>
                            <button
                                onclick="document.getElementById('companyName').value='Global Bit-Assets'; verifyCompany()"
                                class="text-[10px] bg-rose-500/10 border border-rose-500/20 text-rose-400 px-4 py-2 rounded-xl hover:bg-rose-500/20 transition font-black uppercase tracking-widest">Suspicious
                                Corp</button>
                        </div>
                    </div>
                </div>
                <button onclick="verifyCompany()"
                    class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-5 rounded-2xl font-black text-xl hover:from-green-700 hover:to-emerald-700 transition transform hover:scale-[1.02] shadow-xl">Verify
                    Company Legitimacy</button>

                <div id="companyResult" class="hidden mt-12 fade-up">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-1 space-y-8">
                            <div
                                class="glass-card p-8 rounded-[2.5rem] border-white/5 flex flex-col items-center justify-center bg-white/5">
                                <canvas id="companyChart" height="300"></canvas>
                            </div>
                            <div class="glass-card p-8 rounded-[2.5rem] border-white/5 bg-white/5">
                                <canvas id="companyGrowthChart" height="200"></canvas>
                                <p
                                    class="text-[10px] text-gray-500 text-center uppercase tracking-widest mt-6 font-black">
                                    Strategic Market Vectors</p>
                            </div>
                        </div>
                        <div id="companyText" class="lg:col-span-2 space-y-6"></div>
                    </div>
                </div>
            </section>
        </div>

        <div id="content-career" class="tab-content hidden">
            <section class="glass-card rounded-[2.5rem] p-8 sm:p-12 fade-up border-white/10">
                <h2 class="text-3xl font-black text-white mb-8 flex items-center gap-3">
                    <span class="text-4xl">ü§ñ</span> Predictive Guidance
                </h2>
                <div class="mb-8">
                    <label class="block text-xs font-black text-gray-400 mb-3 uppercase tracking-widest">Target Skill or
                        Job Role</label>
                    <div class="relative">
                        <input id="skillInput" type="text"
                            class="w-full border border-white/10 bg-slate-900/50 text-white p-6 rounded-2xl focus:outline-none focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 transition placeholder-gray-500 font-bold text-lg backdrop-blur-md"
                            placeholder="e.g., Python, UI Design, Project Management...">
                        <div class="mt-4 flex flex-wrap gap-2">
                            <button
                                onclick="document.getElementById('skillInput').value='Python Developer'; getCareerGuidance()"
                                class="text-[10px] bg-white/5 border border-white/10 text-gray-400 px-4 py-2 rounded-xl hover:bg-white/10 transition font-black uppercase tracking-widest">Python</button>
                            <button
                                onclick="document.getElementById('skillInput').value='Data Analyst'; getCareerGuidance()"
                                class="text-[10px] bg-white/5 border border-white/10 text-gray-400 px-4 py-2 rounded-xl hover:bg-white/10 transition font-black uppercase tracking-widest">Data
                                Analyst</button>
                            <button
                                onclick="document.getElementById('skillInput').value='Cybersecurity'; getCareerGuidance()"
                                class="text-[10px] bg-indigo-500/10 border border-indigo-500/20 text-indigo-400 px-4 py-2 rounded-xl hover:bg-indigo-500/20 transition font-black uppercase tracking-widest">Cybersecurity</button>
                        </div>
                    </div>
                </div>
                <button onclick="getCareerGuidance()"
                    class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-5 rounded-2xl font-black text-xl hover:from-purple-700 hover:to-pink-700 transition transform hover:scale-[1.02] shadow-xl">Generate
                    AI Career Path</button>

                <div id="careerResult" class="hidden mt-12 fade-up">
                    <div id="careerText" class="space-y-8"></div>
                </div>
            </section>
        </div>
    </div>

    <script>
        // Set Chart.js global font defaults
        if (typeof Chart !== 'undefined') {
            Chart.defaults.font.family = 'Plus Jakarta Sans';
            Chart.defaults.font.weight = 'bold';
        }

        const API_BASE = CONFIG.API_BASE;
        let chart = null;
        let companyChart = null;
        let growthChart = null;
        let companyMap = null;
        let companyMarker = null;

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(c => {
                c.classList.add('hidden');
            });
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.remove('active', 'text-white');
                b.classList.add('text-gray-400');
            });

            document.getElementById('content-' + tabName).classList.remove('hidden');
            const activeBtn = document.getElementById('tab-' + tabName);
            activeBtn.classList.add('active', 'text-white');
            activeBtn.classList.remove('text-gray-400');
        }

        async function analyzeRisk() {
            const text = document.getElementById('inputText').value;
            if (!text.trim()) {
                alert('Please enter job offer text');
                return;
            }

            const btn = document.getElementById('analyzeBtn');
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner !w-6 !h-6 mx-auto !border-t-white"></div>';

            try {
                const response = await fetch(API_BASE + '/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });

                if (!response.ok) throw new Error('Failed to analyze');
                const data = await response.json();
                displayResults(data);
            } catch (e) {
                console.error(e);
                alert('Analysis failed. Please check your connection.');
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }

        function displayResults(data) {
            const result = document.getElementById('result');
            const riskText = document.getElementById('riskText');
            const risk = data.risk_percentage || 0;
            const level = data.risk_level || 'Unknown';
            const riskClass = level.toLowerCase();

            riskText.innerHTML = `
                <div class="space-y-6">
                    <div class="border-b border-white/5 pb-6">
                        <h3 class="text-xs font-black text-gray-400 uppercase tracking-widest mb-4">Risk Assessment Results</h3>
                        <div class="flex items-center gap-6">
                            <div class="text-7xl font-black ${risk < 30 ? 'text-emerald-400' : risk < 70 ? 'text-amber-400' : 'text-rose-500'}">${risk}%</div>
                            <div>
                                <div class="text-xs font-black text-gray-500 uppercase tracking-widest">Overall Risk Level</div>
                                <div class="text-2xl font-black ${risk < 30 ? 'text-emerald-400' : risk < 70 ? 'text-amber-400' : 'text-rose-500'}">${level.toUpperCase()}</div>
                            </div>
                        </div>
                    </div>

                    ${level !== 'Low' ? `
                    <div class="bg-rose-500/10 border border-rose-500/20 rounded-2xl p-6 backdrop-blur-sm">
                        <h4 class="font-black text-rose-400 mb-2 flex items-center gap-2 text-sm uppercase tracking-wide"><span>‚ö†Ô∏è</span> Possible Scam Type: ${data.scam_type || 'Generic Risk'}</h4>
                        <p class="text-sm text-gray-300 font-medium leading-relaxed">${data.scam_type_desc || ''}</p>
                    </div>
                    ` : ''}

                    <div class="glass-card border-white/5 rounded-[2.5rem] p-8 mb-8 bg-indigo-500/5">
                        <h4 class="text-xs font-black text-indigo-400 uppercase tracking-widest mb-6 flex items-center gap-2"><span>üõ°Ô∏è</span> Deep Risk Breakdown</h4>
                        <div class="space-y-6">
                            <div>
                                <div class="flex justify-between mb-2"><span class="text-xs font-black text-gray-400 uppercase tracking-widest">Financial Red Flags</span><span class="text-sm font-black text-rose-500">${data.category_scores.financial}%</span></div>
                                <div class="h-2 bg-white/5 rounded-full overflow-hidden"><div class="h-full bg-rose-500 rounded-full transition-all duration-1000 shadow-[0_0_10px_rgba(244,63,94,0.5)]" style="width: ${data.category_scores.financial}%"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-2"><span class="text-xs font-black text-gray-400 uppercase tracking-widest">Identity Theft Indicators</span><span class="text-sm font-black text-amber-500">${data.category_scores.identity}%</span></div>
                                <div class="h-2 bg-white/5 rounded-full overflow-hidden"><div class="h-full bg-amber-500 rounded-full transition-all duration-1000 shadow-[0_0_10px_rgba(245,158,11,0.5)]" style="width: ${data.category_scores.identity}%"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-2"><span class="text-xs font-black text-gray-400 uppercase tracking-widest">Linguistic Pressure Patterns</span><span class="text-sm font-black text-indigo-400">${data.category_scores.linguistic}%</span></div>
                                <div class="h-2 bg-white/5 rounded-full overflow-hidden"><div class="h-full bg-indigo-500 rounded-full transition-all duration-1000 shadow-[0_0_10px_rgba(99,102,241,0.5)]" style="width: ${data.category_scores.linguistic}%"></div></div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                        <div class="glass-card p-6 rounded-3xl border-rose-500/10 bg-rose-500/5">
                            <h4 class="text-xs font-black text-gray-400 uppercase tracking-widest mb-5 flex items-center gap-2"><span>üö©</span> Critical Red Flags</h4>
                            <ul class="space-y-3 px-1">
                                ${(data.reasons || []).map(r => `<li class="text-xs text-gray-300 flex items-start gap-3 font-medium leading-relaxed underline-offset-4 decoration-rose-500/30"> <span class="text-rose-500 mt-0.5">‚Ä¢</span> ${escapeHtml(r)}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="glass-card p-6 rounded-3xl border-emerald-500/10 bg-emerald-500/5">
                            <h4 class="text-xs font-black text-gray-400 uppercase tracking-widest mb-5 flex items-center gap-2"><span>‚úÖ</span> Safety Action Protocol</h4>
                            <ul class="space-y-3 px-1">
                                ${(data.safety_tips || []).map(t => `<li class="text-xs text-gray-300 flex items-start gap-3 font-medium leading-relaxed"> <span class="text-emerald-500 mt-0.5">‚Ä¢</span> ${escapeHtml(t)}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;

            if (chart) chart.destroy();
            const ctx = document.getElementById('riskChart').getContext('2d');
            const colors = risk < 30 ? '#10b981' : risk < 70 ? '#f59e0b' : '#ef4444';
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Risk', 'Safe'],
                    datasets: [{
                        data: [risk, 100 - risk],
                        backgroundColor: [colors, '#f1f5f9'],
                        borderWidth: 0,
                        cutout: '80%'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false,
                            labels: {
                                font: {
                                    family: 'Plus Jakarta Sans',
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                }
            });

            result.classList.remove('hidden');
            result.scrollIntoView({ behavior: 'smooth' });
        }

        // Helper to prevent XSS
        function escapeHtml(text) {
            if (!text) return '';
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        async function verifyCompany() {
            const companyName = document.getElementById('companyName').value;
            if (!companyName.trim()) {
                alert('Please enter a company name');
                return;
            }

            try {
                const response = await fetch(API_BASE + '/verify-company', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ company_name: companyName })
                });

                if (!response.ok) throw new Error('Failed to verify');
                const data = await response.json();

                const result = document.getElementById('companyResult');
                const text = document.getElementById('companyText');
                const risk = data.risk_percentage;
                const trustScore = 100 - risk;
                const info = data.company_information;

                // Add safety checks for global_checks
                if (!info.global_checks) {
                    info.global_checks = {
                        bbb_registered: false,
                        ftc_reports: 'Unknown',
                        whois_age: 'Unknown',
                        dns_sec: false
                    };
                }

                let statusColor = risk > 70 ? 'text-red-600' : risk > 30 ? 'text-yellow-600' : 'text-green-600';

                text.innerHTML = `
                    <div class="space-y-8">
                        <div class="border-b border-white/5 pb-8 flex flex-wrap justify-between items-start gap-6">
                            <div>
                                <h3 class="text-4xl font-black text-white mb-2">${escapeHtml(info.full_name || data.company_name)}</h3>
                                <div class="flex flex-wrap items-center gap-3">
                                    <div class="flex text-amber-400 text-lg">
                                        ${'‚òÖ'.repeat(Math.round(info.rating))}${'‚òÜ'.repeat(5 - Math.round(info.rating))}
                                    </div>
                                    <span class="text-gray-400 font-bold uppercase tracking-widest text-[10px]">(${info.rating}) Rating</span>
                                    <span class="bg-indigo-500/10 text-indigo-400 border border-indigo-500/20 px-3 py-1 rounded-full text-[8px] font-black uppercase tracking-widest">Source: ${info.data_source || 'Universal Scan'}</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-6xl font-black ${risk > 30 ? (risk > 70 ? 'text-rose-500' : 'text-amber-400') : 'text-emerald-400'}">${trustScore}%</div>
                                <div class="text-[10px] text-gray-500 uppercase tracking-widest font-black mt-1">Trust Integrity Index</div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="glass-card rounded-[2rem] p-6 border-white/5">
                                <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-3">Enterprise Workforce</h4>
                                <div class="flex items-baseline gap-2">
                                    <span class="text-3xl font-black text-white">${escapeHtml(info.employees)}</span>
                                    <span class="text-[10px] text-gray-500 font-black uppercase tracking-widest">Active nodes</span>
                                </div>
                            </div>
                            <div class="glass-card rounded-[2rem] p-6 border-white/5">
                                <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-3">AI Integrity Verdict</h4>
                                <p class="${risk > 30 ? (risk > 70 ? 'text-rose-400' : 'text-amber-400') : 'text-emerald-400'} font-bold text-sm leading-snug">${escapeHtml(data.recommendation)}</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="glass-card rounded-[2rem] p-6 border-white/5">
                                <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-3">Corporate Headquarters</h4>
                                <div class="flex items-center gap-3">
                                    <span class="text-xl">üìç</span>
                                    <span id="headquarters-location" class="text-sm font-bold text-white">${escapeHtml(info.headquarters)}</span>
                                </div>
                                <div class="mt-2 text-[9px] font-black uppercase tracking-widest ${info.location_verified ? 'text-emerald-400' : 'text-rose-400'}">
                                    ${info.location_verified ? '‚úì Verified Physical Office' : '‚ö†Ô∏è Unverified / Virtual Office'}
                                </div>
                            </div>
                            <div class="glass-card rounded-[2rem] p-6 border-white/5">
                                <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-3">Market Sector</h4>
                                <div class="flex items-center gap-3">
                                    <span class="text-xl">üèóÔ∏è</span>
                                    <span class="text-sm font-bold text-white">${escapeHtml(info.industry)}</span>
                                </div>
                            </div>
                        </div>

                        <div class="glass-card rounded-[2rem] p-6 border-white/5 mt-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-widest flex items-center gap-2"><span>üó∫Ô∏è</span> Location View</h4>
                                <button onclick="openInGoogleMaps('${escapeHtml(info.headquarters)}', '${escapeHtml(info.full_name || data.company_name)}')" class="text-[9px] bg-indigo-500/20 text-indigo-400 border border-indigo-500/30 px-3 py-1.5 rounded-xl hover:bg-indigo-500/30 transition font-black uppercase tracking-widest">Open in Maps üîó</button>
                            </div>
                            <div id="companyMap" class="w-full h-[400px] rounded-xl overflow-hidden bg-slate-900/50 border border-white/10 relative">
                                <!-- Loading placeholder -->
                                <div id="map-loading" class="absolute inset-0 flex items-center justify-center">
                                    <div class="spinner !w-8 !h-8 !border-t-indigo-500"></div>
                                </div>
                            </div>
                            <p class="text-[9px] text-gray-500 text-center uppercase tracking-widest mt-3 font-black">Interactive Location Mapping</p>
                        </div>

                        <div class="glass-card border-indigo-500/10 rounded-[2.5rem] p-8 bg-indigo-500/5">
                            <h4 class="text-xs font-black text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-3"><span class="text-xl">üìú</span> Corporate Origin Story</h4>
                            <p class="text-gray-300 font-medium leading-relaxed italic border-l-4 border-indigo-500/50 pl-6">${escapeHtml(info.history)}</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-widest flex items-center gap-2"><span>üõ°Ô∏è</span> Technical Security Signals</h4>
                                <ul class="space-y-3">
                                    ${(data.warning_signs || []).map(w => `<li class="text-[10px] text-rose-400 font-black flex items-start gap-3 bg-rose-500/10 p-4 rounded-xl border border-rose-500/10 uppercase tracking-wider">‚ö†Ô∏è ${escapeHtml(w)}</li>`).join('')}
                                    ${(data.trust_elements || []).map(t => `<li class="text-[10px] text-emerald-400 font-black flex items-start gap-3 bg-emerald-500/10 p-4 rounded-xl border border-emerald-500/10 uppercase tracking-wider">‚úÖ ${escapeHtml(t)}</li>`).join('')}
                                </ul>
                            </div>
                            <div class="space-y-4">
                                <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-widest flex items-center gap-2"><span>üåê</span> Global Registry Intel</h4>
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="p-4 glass-card rounded-2xl border-white/5 text-center">
                                        <div class="text-[8px] text-gray-500 font-black uppercase tracking-[0.2em] mb-1">BBB RATING</div>
                                        <div class="text-[10px] font-black ${info.global_checks.bbb_registered ? 'text-emerald-400' : 'text-gray-600'}">${info.global_checks.bbb_registered ? 'A+ VERIFIED' : 'NOT REG'}</div>
                                    </div>
                                    <div class="p-4 glass-card rounded-2xl border-white/5 text-center">
                                        <div class="text-[8px] text-gray-500 font-black uppercase tracking-[0.2em] mb-1">FTC FILINGS</div>
                                        <div class="text-[10px] font-black ${info.global_checks.ftc_reports === 'Clear' ? 'text-emerald-400' : 'text-rose-500'}">${info.global_checks.ftc_reports.toUpperCase()}</div>
                                    </div>
                                    <div class="p-4 glass-card rounded-2xl border-white/5 text-center">
                                        <div class="text-[8px] text-gray-500 font-black uppercase tracking-[0.2em] mb-1">DOMAIN AGE</div>
                                        <div class="text-[10px] font-black text-indigo-400">${info.global_checks.whois_age}</div>
                                    </div>
                                    <div class="p-4 glass-card rounded-2xl border-white/5 text-center">
                                        <div class="text-[8px] text-gray-500 font-black uppercase tracking-[0.2em] mb-1">DNSSEC</div>
                                        <div class="text-[10px] font-black ${info.global_checks.dns_sec ? 'text-emerald-400' : 'text-rose-500'}">${info.global_checks.dns_sec ? 'ACTIVE' : 'INACTIVE'}</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        ${(info.competitors && info.competitors.length > 0) ? `
                        <div class="bg-blue-50/50 border border-blue-100 rounded-[2rem] p-8 mt-6">
                            <h4 class="text-xs font-black text-blue-800 uppercase tracking-widest flex items-center gap-2 mb-4"><span>üè¢</span> Related Companies / Competitors</h4>
                            <div class="flex flex-wrap gap-3">
                                ${info.competitors.map(comp => `
                                    <div class="bg-white px-4 py-2 rounded-xl shadow-sm border border-blue-50 text-sm font-bold text-gray-700 flex items-center gap-2">
                                        <span class="w-2 h-2 rounded-full bg-blue-400"></span>
                                        ${escapeHtml(comp)}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}

                        <div class="pt-6 flex flex-wrap gap-4">
                            ${info.linkedin ? `<a href="${info.linkedin}" target="_blank" class="bg-[#0077b5] text-white px-8 py-4 rounded-2xl font-black hover:opacity-90 transition flex items-center gap-2"><span>üîó</span> LinkedIn Profile</a>` : ''}
                            ${info.website ? `<a href="${info.website}" target="_blank" class="glass text-gray-800 px-8 py-4 rounded-2xl font-black hover:bg-white/20 transition border border-gray-200 flex items-center gap-2"><span>üåê</span> Official Site</a>` : ''}
                            ${info.glassdoor ? `<a href="${info.glassdoor}" target="_blank" class="bg-emerald-600 text-white px-8 py-4 rounded-2xl font-black hover:opacity-90 transition flex items-center gap-2"><span>üè¢</span> Glassdoor</a>` : ''}
                        </div>
                    </div>
                `;

                // Update Doughnut Chart
                if (companyChart) companyChart.destroy();
                const ctxDoughnut = document.getElementById('companyChart').getContext('2d');
                companyChart = new Chart(ctxDoughnut, {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: [trustScore, risk],
                            backgroundColor: [statusColor.includes('green') ? '#10b981' : (statusColor.includes('yellow') ? '#f59e0b' : '#ef4444'), '#f1f5f9'],
                            borderWidth: 0,
                            cutout: '80%'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false,
                                labels: {
                                    font: {
                                        family: 'Plus Jakarta Sans',
                                        weight: 'bold'
                                    }
                                }
                            }
                        }
                    }
                });

                // Update Growth Chart
                if (growthChart) growthChart.destroy();
                const ctxLine = document.getElementById('companyGrowthChart').getContext('2d');
                growthChart = new Chart(ctxLine, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Market Score',
                            data: info.growth_stats,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 4,
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false,
                                labels: {
                                    font: {
                                        family: 'Plus Jakarta Sans',
                                        weight: 'bold'
                                    }
                                }
                            }
                        },
                        scales: {
                            y: { display: false },
                            x: {
                                grid: { display: false },
                                ticks: {
                                    font: {
                                        family: 'Plus Jakarta Sans',
                                        weight: 'bold',
                                        size: 10
                                    }
                                }
                            }
                        }
                    }
                });

                // Initialize Google Maps
                initializeCompanyMap(info.headquarters, info.full_name || data.company_name);

                result.classList.remove('hidden');
                result.scrollIntoView({ behavior: 'smooth' });
            } catch (e) {
                console.error(e);
                alert('Verification failed. Try again soon.');
            }
        }

        async function getCareerGuidance() {
            const skill = document.getElementById('skillInput').value;
            if (!skill.trim()) {
                alert('Please enter a skill');
                return;
            }

            try {
                const response = await fetch(API_BASE + '/career-guidance', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ skill })
                });

                const data = await response.json();
                const result = document.getElementById('careerResult');
                const text = document.getElementById('careerText');

                // Check if the career goal is unrealistic
                if (data.status === 'unrealistic_career') {
                    text.innerHTML = `
                        <div class="space-y-8">
                            <div class="text-center mb-10">
                                <div class="text-6xl mb-6">ü§î</div>
                                <h3 class="text-4xl font-black text-white mb-3 capitalize">${escapeHtml(data.skill_searched)}</h3>
                                <div class="bg-amber-500/20 text-amber-300 border border-amber-500/30 px-8 py-4 rounded-2xl font-bold text-base max-w-2xl mx-auto backdrop-blur-md">
                                    ${escapeHtml(data.message)}
                                </div>
                            </div>

                            <div class="glass-card border-indigo-500/20 rounded-[2.5rem] p-10 mb-12 bg-indigo-500/5">
                                <h4 class="text-xl font-black text-indigo-400 uppercase tracking-wide mb-6 flex items-center gap-3">
                                    <span>üí°</span> Realistic Career Alternatives
                                </h4>
                                <p class="text-gray-300 mb-8 font-medium leading-relaxed">${escapeHtml(data.helpful_tip)}</p>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    ${data.realistic_alternatives.map(alt => `
                                        <div class="glass-card p-6 rounded-2xl border-emerald-500/20 bg-emerald-500/5 hover:border-emerald-500/40 transition-all group">
                                            <div class="flex items-start gap-4 mb-4">
                                                <div class="text-3xl">‚úÖ</div>
                                                <div class="flex-1">
                                                    <h5 class="text-xl font-black text-white mb-2 group-hover:text-emerald-400 transition-colors">${escapeHtml(alt.title)}</h5>
                                                    <p class="text-sm text-gray-400 font-medium leading-relaxed">${escapeHtml(alt.reason)}</p>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-indigo-500/10 to-purple-500/10 border border-indigo-500/20 rounded-[2.5rem] p-8 sm:p-12">
                                <h4 class="text-2xl font-black text-white mb-6 flex items-center gap-3">
                                    <span>üéØ</span> Next Steps
                                </h4>
                                <div class="space-y-4">
                                    <div class="flex items-start gap-4">
                                        <span class="text-2xl">1Ô∏è‚É£</span>
                                        <p class="text-gray-300 font-medium">Pick one of the realistic alternatives above that excites you</p>
                                    </div>
                                    <div class="flex items-start gap-4">
                                        <span class="text-2xl">2Ô∏è‚É£</span>
                                        <p class="text-gray-300 font-medium">Research what that career actually involves (day-to-day work, education needed)</p>
                                    </div>
                                    <div class="flex items-start gap-4">
                                        <span class="text-2xl">3Ô∏è‚É£</span>
                                        <p class="text-gray-300 font-medium">Start learning the required skills through online courses or degree programs</p>
                                    </div>
                                    <div class="flex items-start gap-4">
                                        <span class="text-2xl">4Ô∏è‚É£</span>
                                        <p class="text-gray-300 font-medium">Build projects or gain experience to create a portfolio</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    // Normal career guidance display
                    text.innerHTML = `
                        <div class="space-y-8">
                            <div class="text-center mb-10">
                                <h3 class="text-4xl font-black text-white mb-3 capitalize">${escapeHtml(data.skill_searched)}</h3>
                                <div class="flex items-center justify-center gap-4 flex-wrap">
                                    <div class="bg-indigo-500/20 text-indigo-400 border border-indigo-500/20 px-6 py-2 rounded-xl font-black text-[10px] uppercase tracking-[0.2em] backdrop-blur-md">Demand: ${escapeHtml(data.market_outlook)}</div>
                                    <div class="bg-purple-500/20 text-purple-400 border border-purple-500/20 px-6 py-2 rounded-xl font-black text-[10px] uppercase tracking-[0.2em] backdrop-blur-md">Complexity: ${data.difficulty_rating}/10</div>
                                </div>
                            </div>

                            <div class="glass-card border-white/5 rounded-[2.5rem] p-10 mb-12 bg-white/5">
                                <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-[0.2em] mb-8 flex items-center gap-3"><span>üìä</span> Projected Compensation Vectors</h4>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-8">
                                    <div class="bg-white/5 border border-white/5 p-6 rounded-3xl text-center">
                                        <div class="text-[9px] font-black text-gray-500 uppercase tracking-widest mb-3">ENTRY NODE</div>
                                        <div class="text-2xl font-black text-emerald-400">${data.salary_benchmarks.entry}</div>
                                    </div>
                                    <div class="glass-card border-indigo-500/30 p-8 rounded-3xl text-center scale-110 shadow-2xl shadow-indigo-500/10">
                                        <div class="text-[9px] font-black text-indigo-400 uppercase tracking-[0.2em] mb-3">CORE MAPPING</div>
                                        <div class="text-2xl font-black text-white">${data.salary_benchmarks.mid}</div>
                                    </div>
                                    <div class="bg-white/5 border border-white/5 p-6 rounded-3xl text-center">
                                        <div class="text-[9px] font-black text-gray-500 uppercase tracking-widest mb-3">SENIOR SECTOR</div>
                                        <div class="text-2xl font-black text-purple-400">${data.salary_benchmarks.senior}</div>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                ${(data.careers || []).map(career => `
                                    <div class="glass-card p-8 rounded-[2.5rem] border-white/5 hover:border-indigo-500/30 group">
                                        <div class="flex justify-between items-start mb-6">
                                            <h4 class="text-2xl font-black text-white group-hover:text-indigo-400 transition-colors">${escapeHtml(career.title)}</h4>
                                            <span class="text-[9px] bg-emerald-500/20 text-emerald-400 px-3 py-1.5 rounded-xl font-black uppercase tracking-widest">${escapeHtml(career.growth)} GROWTH</span>
                                        </div>
                                        <p class="text-xs text-gray-500 font-black uppercase tracking-widest mb-6">Base Valuation: <span class="text-white ml-2">${escapeHtml(career.salary)}</span></p>
                                        <div class="flex flex-wrap gap-2">
                                            ${(career.skills || []).map(s => `<span class="text-[9px] bg-white/5 border border-white/5 text-gray-400 px-3 py-1.5 rounded-xl font-black uppercase tracking-widest group-hover:border-indigo-500/20 transition-colors">${escapeHtml(s)}</span>`).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>

                            <div class="mt-12 bg-white/5 border border-white/10 rounded-[2.5rem] p-8 sm:p-12 backdrop-blur-md">
                                <div class="flex items-center justify-between mb-10">
                                    <h4 class="text-3xl font-black text-white flex items-center gap-4">
                                        <span class="p-3 bg-purple-500/20 rounded-2xl text-2xl">üìà</span> 
                                        Advanced Career Roadmap
                                    </h4>
                                    <div class="hidden sm:block text-[10px] font-black text-purple-400 uppercase tracking-[0.3em]">AI Tailored Path</div>
                                </div>
                                
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
                                    ${(data.detailed_roadmap || []).map((phase, idx) => `
                                        <div class="space-y-6">
                                            <div class="flex items-center gap-3 mb-6">
                                                <span class="w-8 h-8 flex items-center justify-center bg-purple-500 text-white rounded-lg font-black text-sm">${idx + 1}</span>
                                                <h5 class="text-xl font-black text-white uppercase tracking-tight">${escapeHtml(phase.phase)}</h5>
                                            </div>
                                            <div class="space-y-4">
                                                ${(phase.steps || []).map(step => `
                                                    <div class="glass-card p-6 rounded-3xl border-white/5 hover:border-purple-500/30 transition-all group bg-white/[0.02]">
                                                        <h6 class="text-white font-black mb-3 group-hover:text-purple-400 transition-colors flex justify-between items-start gap-2">
                                                            ${escapeHtml(step.title)}
                                                            <span class="text-[8px] bg-white/5 px-2 py-1 rounded-md text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity uppercase font-black">Step</span>
                                                        </h6>
                                                        <p class="text-[11px] text-gray-400 font-medium leading-relaxed mb-4">${escapeHtml(step.notes)}</p>
                                                        <button onclick="window.open('https://www.youtube.com/results?search_query=${encodeURIComponent(step.video_query)}', '_blank')" 
                                                                class="w-full py-2.5 bg-white/5 hover:bg-red-500/10 border border-white/5 hover:border-red-500/30 rounded-xl text-[10px] font-black text-gray-400 hover:text-red-400 transition-all flex items-center justify-center gap-2 uppercase tracking-widest">
                                                            <span class="text-base">üé¨</span> Best Video Guide
                                                        </button>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                }

                result.classList.remove('hidden');
                result.scrollIntoView({ behavior: 'smooth' });
            } catch (e) {
                console.error(e);
                alert('Failed to generate guidance. Please try again.');
            }
        }

        function loadAndAnalyze(index) {
            const testData = [
                'URGENT! Work from home opportunity. Send $500 registration fee to secure your position. High salary guaranteed!',
                'We are looking for a Software Engineer at Google. Please apply through our official careers page at careers.google.com',
                'Congratulations! You have been selected. Please provide your bank details and SSN for verification.'
            ];
            if (testData[index]) {
                document.getElementById('inputText').value = testData[index];
                analyzeRisk();
            }
        }

        // Open location in Google Maps (new window/tab)
        function openInGoogleMaps(location, companyName) {
            // Include company name for better search precision - standard "Name, Address" format
            const searchQuery = (companyName && location !== 'Unverified Location' && location !== 'Location Unknown')
                ? `${companyName}, ${location}`
                : location;
            const encodedLocation = encodeURIComponent(searchQuery);
            window.open(`https://www.google.com/maps/search/?api=1&query=${encodedLocation}`, '_blank');
        }

        // Initialize Company Map using iframe embed (more reliable than API)
        function initializeCompanyMap(locationString, companyName) {
            const mapElement = document.getElementById('companyMap');

            if (!mapElement) {
                console.error('Map element not found');
                return;
            }

            console.log('Initializing map for location:', locationString, 'Company:', companyName);

            try {
                // IMPORTANT: Completely clear the map container first
                // This ensures we don't have old iframes or content
                mapElement.innerHTML = '';

                // Add a unique timestamp to force iframe reload
                const timestamp = new Date().getTime();

                // Create a more specific search query by combining company name with location
                // Standard format: [Name], [Address]
                const searchQuery = (companyName && locationString !== 'Unverified Location' && locationString !== 'Location Unknown')
                    ? `${companyName}, ${locationString}`
                    : locationString;
                const encodedLocation = encodeURIComponent(searchQuery);

                // Create loading indicator first
                const loadingDiv = document.createElement('div');
                loadingDiv.id = 'map-loading';
                loadingDiv.className = 'absolute inset-0 flex items-center justify-center bg-slate-900/50 z-10';
                loadingDiv.innerHTML = '<div class="spinner !w-8 !h-8 !border-t-indigo-500"></div>';
                mapElement.appendChild(loadingDiv);

                // Create iframe with Google Maps embed
                const iframe = document.createElement('iframe');
                iframe.id = 'company-map-iframe-' + timestamp; // Unique ID
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                iframe.style.border = '0';
                iframe.style.borderRadius = '0.75rem';
                iframe.setAttribute('loading', 'eager');
                iframe.setAttribute('referrerpolicy', 'no-referrer-when-downgrade');
                iframe.setAttribute('allowfullscreen', '');

                // Detect if location is likely a specific address or just a city/state
                // Specific addresses usually have numbers (street address) or multiple parts
                const isSpecific = (/\d/.test(locationString)) || (locationString.split(',').length > 1);
                const zoom = isSpecific ? 17 : 12;

                // URL with company name + location for better accuracy
                iframe.src = `https://www.google.com/maps/embed/v1/place?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&q=${encodedLocation}&zoom=${zoom}`;

                // Handle load events
                iframe.onload = function () {
                    console.log('Map loaded successfully for:', locationString);
                    const loader = document.getElementById('map-loading');
                    if (loader) {
                        loader.style.display = 'none';
                    }
                };

                iframe.onerror = function () {
                    console.error('Map failed to load, showing fallback');
                    showMapFallback(mapElement, locationString, companyName);
                };

                // Add iframe to the map container
                mapElement.appendChild(iframe);

                // Hide loading after 3 seconds as fallback
                setTimeout(() => {
                    const loader = document.getElementById('map-loading');
                    if (loader) {
                        loader.style.display = 'none';
                    }
                }, 3000);

            } catch (error) {
                console.error('Error creating map:', error);
                showMapFallback(mapElement, locationString, companyName);
            }
        }

        // Show fallback UI when map fails to load
        function showMapFallback(mapElement, locationString, companyName) {
            if (!mapElement) return;

            const searchQuery = (companyName && locationString !== 'Unverified Location' && locationString !== 'Location Unknown')
                ? `${companyName}, ${locationString}`
                : locationString;
            const encodedLocation = encodeURIComponent(searchQuery);
            mapElement.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full p-8 text-center">
                    <div class="text-6xl mb-4">üó∫Ô∏è</div>
                    <div class="text-white font-bold text-lg mb-2">${escapeHtml(companyName || 'Location View')}</div>
                    <div class="text-gray-400 text-sm mb-2">${escapeHtml(locationString)}</div>
                    <div class="text-gray-500 text-[10px] mb-6 lowercase tracking-wider italic">unable to load embedded view</div>
                    <a href="https://www.google.com/maps/search/?api=1&query=${encodedLocation}" target="_blank" 
                       class="bg-indigo-500 hover:bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold transition inline-flex items-center gap-2">
                        <span>Open in Google Maps</span>
                        <span>üîó</span>
                    </a>
                </div>
            `;
        }

        window.addEventListener('load', () => {
            setTimeout(() => {
                const loader = document.getElementById('pageLoader');
                if (loader) {
                    loader.classList.add('hidden');
                    setTimeout(() => loader.remove(), 500);
                }
            }, 300);
        });
    </script>
</body>

</html>